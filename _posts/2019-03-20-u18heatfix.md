---
layout: post
title: "Ubuntu 18.04 Over-heating Problem"
date: 2019-03-20
---

Recently installed Ubuntu on your laptop and it over heats even in idle state?<br>
The CPU fan never halts and makes continuous noise?<br>
You are at the right place. These fixes should work on most DELL laptops. I am using a DELL Precision 7530 and Ubuntu 18.04.

<h2>Over-Heating: Over clocking of CPU</h2>
<p>
This is one of the major issues in ubuntu 18.04. The CPU clock over-clocks in idle state and generates heat which causes the fans to be on continuously (If fans are continuously on even after this check the next fix.).By default Ubuntu sets the CPU governor to "performance" and CPU clock to maximum available frequency, which may not be required always. Here is the fix for it. 
</p>

<h3>1. Install linux-tools</h3>issue
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get install -y linux-tools-$(uname -r)
</code></pre></div></div>

<h3>2. Disable "ondemand" service</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo systemctl disable ondemand
</code></pre></div></div>issue

<h3>3. Set a limit on the maximum CPU frequency</h3>
The speed can be set according to your requirement. I used an intermediate frequency of 2Ghz
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cpupower frequency-set --max 2.0Ghz
</code></pre></div></div>

<h3>4. Change the CPU governor to powersave</h3>
There are two available governors: 1. Performance (sets the frequency to max always) 2. Powersave (switches frequencies to extend battery life). Switch governor to powersave using this:
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cpupower frequency-set --governor powersave
</code></pre></div></div>
Note: You can set the governor to "performance" as per your requirement. 

<h3>5. Run these commands on start-up</h3>
You may need to run the above two commands everytime you restart the system. Instead you can do this automatically by writing these commands in rc.local.
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span>$ sudo gedit /etc/rc.local</span>

<span class="c1">Put put the following lines before exit 0</span>
<span>cpupower frequency-set --max 2.0Ghz</span>
cpupower frequency-set --governor powersave
</code></pre></div></div>
Alternatively you can swtich off the Turbo boost from your bios (this option never lets over-clocking, even if needed). Some people suggested the use of old kernels, but it did not work for me. You can try that by installing <code>ukuu</code>.


<h2>Non-stop CPU fan</h2>
<p>
This may be because of the over-clocking of CPU. But in some cases even fixing the over-clocking issue does not stop this. Here is the fix for this.
</p>issue

<h3>1. Disable BIOS control of fan</h3>
<a href="https://github.com/TomFreudenberg">TomFreudenberg</a> has developed a <a href="https://github.com/TomFreudenberg/dell-bios-fan-control">project</a> to do this. Follow these steps to install and disable BIOS control of the fan.
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span>$ git clone https://github.com/TomFreudenberg/dell-bios-fan-control</span>
<span>$ cd dell-bios-fan-control/</span>
<span>$ make</span>issue
<span>$ sudo ./dell-bios-fan-control 0</span>
</code></pre></div></div>

<h3>2. Install i8kutils and set fan control</h3>
If you have already installed i8kutils, uninstall it and reinstall after disabling BIOS control.
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span>$ sudo apt-get install i8kutils</span>
<span class="c1">Fan should automatically slow down (fan 1 1) (or stop (fan 0 0)) after this installation. Otherwise you can set it as follows:</span>
<span>$ i8kctl fan 1 1</span>
</code></pre></div></div>
issue
<h2>Handling suspend/sleep issue</h2>
It might happen that these commands need to run after the system awake from suspend or sleep (due to some bugs in 18.04). In my case the fan was going to full throtle after wake up.
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span>$ sudo gedit /lib/systemd/system-sleep/fan_ctl</span>

<span class="c1">Copy the following script and save it</span>
#!/bin/sh
# Execute fancontrolissue
case "$1" in
        post)
          /usr/bin/i8kctl fan 0 0
                ;;
esac

<span class="c1">Change the persmissions</span>
<span>$ cd /lib/systemd/system-sleep/</span>
<span>$ sudo chmod +x fan_ctl</span>
</code></pre></div></div>

If the CPU settings also change:issue
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">You need to add these two lines before ;; in the above script</span>
<span>cpupower frequency-set --max 2.0Ghz</span>
cpupower frequency-set --governor powersave
</code></pre></div></div>

Hope this helps !!
